<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAHR LAB Wiki</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: #f8f9fa;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
            margin-bottom: 30px;
        }
        
        .logo {
            cursor: pointer;
            height: 27px;
        }
        
        .wiki-title {
            font-size: 28px;
            font-weight: 700;
            color: #000;
            margin-bottom: 5px;
        }
        
        .wiki-subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 30px;
        }
        
        .search-container {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        
        .search-input {
            width: 100%;
            padding: 16px;
            font-size: 18px;
            border: 2px solid #eaeaea;
            border-radius: 12px;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #000;
        }
        
        .search-button {
            width: 100%;
            padding: 16px;
            font-size: 18px;
            background: #000;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        .search-button:hover {
            background: #333;
        }
        
        .suggestions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .suggestion-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid #eaeaea;
        }
        
        .suggestion-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        
        .suggestion-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #000;
        }
        
        .suggestion-desc {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }
        
        .wiki-content {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .wiki-header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .wiki-page-title {
            font-size: 36px;
            font-weight: 700;
            color: #000;
            margin-bottom: 10px;
        }
        
        .wiki-category {
            display: inline-block;
            background: #f0f0f0;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            margin-bottom: 15px;
        }
        
        .wiki-image {
            width: 100%;
            max-width: 400px;
            height: auto;
            border-radius: 12px;
            margin: 20px 0;
            display: block;
            border: 1px solid #eaeaea;
        }
        
        .wiki-section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #eaeaea;
            color: #000;
        }
        
        .wiki-text {
            line-height: 1.7;
            margin-bottom: 20px;
            font-size: 16px;
        }
        
        .wiki-text strong {
            font-weight: 700;
            color: #000;
        }
        
        .wiki-text em {
            font-style: italic;
            color: #666;
        }
        
        .wiki-list {
            margin-left: 20px;
            margin-bottom: 20px;
        }
        
        .wiki-list li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .fact-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #000;
        }
        
        .fact-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #000;
        }
        
        .related-topics {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eaeaea;
        }
        
        .related-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .topic-tag {
            padding: 8px 16px;
            background: #f0f0f0;
            border-radius: 20px;
            cursor: pointer;
            transition: background 0.3s;
            border: none;
            font-size: 14px;
        }
        
        .topic-tag:hover {
            background: #e0e0e0;
        }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            background: #ffebee;
            color: #d32f2f;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }
        
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #f8f9fa;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .info-table th {
            background: #eaeaea;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        
        .info-table td {
            padding: 12px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .info-table tr:last-child td {
            border-bottom: none;
        }
        
        @media (max-width: 600px) {
            body {
                padding: 15px;
            }
            
            .search-container,
            .wiki-content {
                padding: 20px;
            }
            
            .wiki-page-title {
                font-size: 28px;
            }
            
            .suggestions-grid {
                grid-template-columns: 1fr;
            }
            
            .search-input,
            .search-button {
                font-size: 16px;
                padding: 14px;
            }
            
            .section-title {
                font-size: 20px;
            }
            
            .info-table {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="https://raw.githubusercontent.com/bahrlab/bahrlab.github.io/refs/heads/main/files/images/BAHRLABLOGO.png" alt="BAHR LAB" class="logo" onclick="goHome()">
    </div>
    
    <div id="homePage">
        <div class="wiki-title">BAHR LAB Wiki</div>
        <div class="wiki-subtitle">AI-generated knowledge base</div>
        
        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="Search for any topic..." autocomplete="off">
            <button class="search-button" onclick="searchTopic()">Search</button>
        </div>
        
        <div id="suggestionsContainer"></div>
    </div>
    
    <div id="wikiPage" style="display: none;">
        <div id="loadingWiki" class="loading" style="display: none;">
            <div class="loading-spinner"></div>
            <div>Generating wiki page...</div>
        </div>
        
        <div id="wikiError" class="error-message" style="display: none;"></div>
        
        <div class="wiki-content" id="wikiContent" style="display: none;">
            <div class="wiki-header">
                <h1 class="wiki-page-title" id="wikiTitle"></h1>
                <div class="wiki-category" id="wikiCategory"></div>
                <div class="wiki-text" id="wikiIntro"></div>
            </div>
            
            <div id="wikiImageContainer"></div>
            
            <table class="info-table" id="infoTable"></table>
            
            <div id="wikiSections"></div>
            
            <div id="wikiFacts"></div>
            
            <div class="related-topics">
                <div class="section-title">Related Topics</div>
                <div class="related-tags" id="relatedTopics"></div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = "https://freeai.logise1123.workers.dev/";
        let currentTopic = '';
        
        function goHome() {
            window.location.href = "https://bahrlab.github.io/wiki";
        }
        
        function searchTopic() {
            const topic = document.getElementById('searchInput').value.trim();
            if (topic) {
                window.location.href = `https://bahrlab.github.io/wiki?d=${encodeURIComponent(topic)}`;
            }
        }
        
        function goToTopic(topic) {
            window.location.href = `https://bahrlab.github.io/wiki?d=${encodeURIComponent(topic)}`;
        }
        
        function generateImage(prompt) {
            return `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=512&height=512&nofetch=true`;
        }
        
        async function generateWikiPage(topic) {
            currentTopic = topic;
            
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('wikiPage').style.display = 'block';
            document.getElementById('loadingWiki').style.display = 'block';
            document.getElementById('wikiContent').style.display = 'none';
            document.getElementById('wikiError').style.display = 'none';
            
            try {
                const prompt = `Create comprehensive wiki page about "${topic}". 
Return ONLY this JSON structure:
{
"title": "${topic}",
"category": "Science/History/Technology/Art/Nature/Culture/Geography/Mathematics/Physics/Biology",
"intro": "Concise 2-3 sentence introduction",
"image_prompt": "detailed realistic image prompt for ${topic}",
"quick_facts": [
{"fact": "Type/Classification", "value": ""},
{"fact": "Discovered/Established", "value": ""},
{"fact": "Significance", "value": ""},
{"fact": "Location/Origin", "value": ""}
],
"sections": [
{"title": "Overview", "content": "Detailed overview with key information"},
{"title": "History", "content": "Historical background and development"},
{"title": "Characteristics", "content": "Key features and properties"},
{"title": "Impact", "content": "Significance and influence"}
],
"key_points": ["point 1", "point 2", "point 3", "point 4"],
"related": ["topic1", "topic2", "topic3", "topic4"]
}

Make content detailed, accurate, and educational. Use **bold** for important terms.`;

                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: 'llama-3.1-8b-instruct-fast',
                        messages: [{ role: 'user', content: prompt }]
                    })
                });
                
                if (!response.ok) throw new Error('API error');
                
                const data = await response.json();
                const aiResponse = data?.choices?.[0]?.message?.content || "{}";
                
                let wikiData;
                try {
                    const jsonMatch = aiResponse.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        wikiData = JSON.parse(jsonMatch[0]);
                        
                        if (!wikiData.title || wikiData.title === '[object Object]') {
                            throw new Error("Invalid data");
                        }
                    } else {
                        throw new Error("No JSON found");
                    }
                } catch (e) {
                    console.error("Parse error:", e);
                    wikiData = await createFallbackWiki(topic);
                }
                
                displayWikiPage(wikiData);
                
            } catch (error) {
                console.error("Wiki error:", error);
                document.getElementById('wikiError').textContent = "Error generating wiki page. Please try again.";
                document.getElementById('wikiError').style.display = 'block';
                const fallbackData = await createFallbackWiki(topic);
                displayWikiPage(fallbackData);
            }
            
            document.getElementById('loadingWiki').style.display = 'none';
            document.getElementById('wikiContent').style.display = 'block';
        }
        
        async function createFallbackWiki(topic) {
            try {
                const prompt = `Give me basic facts about "${topic}" in JSON format:
{
"title": "${topic}",
"category": "General",
"intro": "${topic} is an interesting topic worth exploring.",
"image_prompt": "${topic} illustration",
"quick_facts": [
{"fact": "Type", "value": "General topic"},
{"fact": "Significance", "value": "Important subject"}
],
"sections": [
{"title": "About", "content": "This page provides information about ${topic}."}
],
"key_points": ["Interesting subject", "Widely studied", "Multiple aspects"],
"related": ["Similar topics", "Related fields"]
}`;

                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: 'llama-3.1-8b-instruct-fast',
                        messages: [{ role: 'user', content: prompt }]
                    })
                });
                
                const data = await response.json();
                const aiResponse = data?.choices?.[0]?.message?.content || "{}";
                
                try {
                    const jsonMatch = aiResponse.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        return JSON.parse(jsonMatch[0]);
                    }
                } catch (e) {
                    // Continue to default fallback
                }
            } catch (error) {
                console.error("Fallback error:", error);
            }
            
            return {
                title: topic,
                category: "General",
                intro: `${topic} is a fascinating subject that has captured widespread interest. This wiki page provides comprehensive information about its history, characteristics, and significance.`,
                image_prompt: `${topic} detailed realistic illustration`,
                quick_facts: [
                    {"fact": "Classification", "value": "General knowledge topic"},
                    {"fact": "Relevance", "value": "Widely studied and discussed"},
                    {"fact": "Field", "value": "Multiple disciplines"},
                    {"fact": "Complexity", "value": "Varies by perspective"}
                ],
                sections: [
                    {
                        "title": "Overview",
                        "content": `**${topic}** represents an area of knowledge that encompasses various aspects and interpretations. Its study has contributed significantly to our understanding of related fields.`
                    },
                    {
                        "title": "Historical Context",
                        "content": `The concept of ${topic} has evolved over time, with different civilizations and cultures contributing to its development and understanding.`
                    },
                    {
                        "title": "Key Characteristics",
                        "content": `Key features of ${topic} include its multifaceted nature, diverse applications, and ongoing relevance in contemporary discussions.`
                    },
                    {
                        "title": "Modern Significance",
                        "content": `Today, ${topic} continues to influence various domains including science, culture, technology, and education.`
                    }
                ],
                key_points: [
                    `${topic} has historical significance`,
                    `Multiple perspectives exist`,
                    `Continues to evolve`,
                    `Interdisciplinary relevance`
                ],
                related: ["Similar concepts", "Related studies", "Associated fields", "Comparative topics"]
            };
        }
        
        function formatWikiText(text) {
            if (!text) return '';
            
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\n\n/g, '</p><p class="wiki-text">')
                .replace(/\n/g, '<br>');
        }
        
        function displayWikiPage(wikiData) {
            document.getElementById('wikiTitle').textContent = wikiData.title || currentTopic;
            document.getElementById('wikiCategory').textContent = wikiData.category || "General";
            document.getElementById('wikiIntro').innerHTML = formatWikiText(wikiData.intro || '');
            
            const imageUrl = generateImage(wikiData.image_prompt || wikiData.title || currentTopic);
            document.getElementById('wikiImageContainer').innerHTML = `
                <img src="${imageUrl}" alt="${wikiData.title || currentTopic}" class="wiki-image" onerror="this.style.display='none'">
            `;
            
            if (wikiData.quick_facts && wikiData.quick_facts.length > 0) {
                let tableHtml = '<tr><th>Fact</th><th>Details</th></tr>';
                wikiData.quick_facts.forEach(fact => {
                    if (fact.fact && fact.value) {
                        tableHtml += `<tr><td><strong>${fact.fact}</strong></td><td>${fact.value}</td></tr>`;
                    }
                });
                document.getElementById('infoTable').innerHTML = tableHtml;
            }
            
            const sectionsHtml = (wikiData.sections || []).map(section => `
                <div class="wiki-section">
                    <h2 class="section-title">${section.title || 'Section'}</h2>
                    <div class="wiki-text">${formatWikiText(section.content || '')}</div>
                </div>
            `).join('');
            document.getElementById('wikiSections').innerHTML = sectionsHtml;
            
            if (wikiData.key_points && wikiData.key_points.length > 0) {
                const factsHtml = wikiData.key_points.map(point => `
                    <div class="fact-box">
                        <div class="fact-title">ðŸ“Œ Key Point</div>
                        <div>${formatWikiText(point)}</div>
                    </div>
                `).join('');
                document.getElementById('wikiFacts').innerHTML = factsHtml;
            }
            
            const relatedTopics = wikiData.related || [];
            const relatedHtml = relatedTopics.map(topic => 
                `<button class="topic-tag" onclick="goToTopic('${topic}')">${topic}</button>`
            ).join('');
            document.getElementById('relatedTopics').innerHTML = relatedHtml;
        }
        
        async function generateSuggestions() {
            try {
                const prompt = `Suggest 8 diverse topics for wiki articles. Return ONLY JSON array: ["Artificial Intelligence", "Roman Empire", "Quantum Mechanics", "Renaissance Art", "Climate Change", "Ancient Egypt", "Space Exploration", "Human Genome"]`;

                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: 'llama-3.1-8b-instruct-fast',
                        messages: [{ role: 'user', content: prompt }]
                    })
                });
                
                const data = await response.json();
                const aiResponse = data?.choices?.[0]?.message?.content || "[]";
                
                let suggestions;
                try {
                    suggestions = JSON.parse(aiResponse);
                } catch (e) {
                    suggestions = ["Artificial Intelligence", "Roman Empire", "Quantum Mechanics", "Renaissance Art", "Climate Change", "Ancient Egypt", "Space Exploration", "Human Genome"];
                }
                
                displaySuggestions(suggestions);
                
            } catch (error) {
                const fallback = ["Artificial Intelligence", "Roman Empire", "Quantum Mechanics", "Renaissance Art", "Climate Change", "Ancient Egypt", "Space Exploration", "Human Genome"];
                displaySuggestions(fallback);
            }
        }
        
        function displaySuggestions(suggestions) {
            const container = document.getElementById('suggestionsContainer');
            if (!container) return;
            
            const suggestionsHtml = suggestions.map(topic => `
                <div class="suggestion-card" onclick="goToTopic('${topic}')">
                    <div class="suggestion-title">${topic}</div>
                    <div class="suggestion-desc">Learn about ${topic} - comprehensive wiki article</div>
                </div>
            `).join('');
            
            container.innerHTML = `
                <div style="font-size: 20px; font-weight: 600; margin-bottom: 20px; color: #000;">Popular Topics</div>
                <div class="suggestions-grid">
                    ${suggestionsHtml}
                </div>
            `;
        }
        
        function checkUrlForTopic() {
            const urlParams = new URLSearchParams(window.location.search);
            const topic = urlParams.get('d');
            
            if (topic) {
                document.getElementById('searchInput').value = topic;
                generateWikiPage(topic);
            } else {
                document.getElementById('homePage').style.display = 'block';
                document.getElementById('wikiPage').style.display = 'none';
                generateSuggestions();
            }
        }
        
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchTopic();
            }
        });
        
        window.onload = checkUrlForTopic;
    </script>
</body>
</html>
